<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Premios Herencia Torrente</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 3.5rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .music-btn {
            background: #ffd700;
            color: black;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .music-btn:hover {
            background: #ffed4e;
        }

        .grid-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .grid-main {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .grid-bottom {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .box {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            transition: all 0.5s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .box:hover {
            transform: scale(1.05);
        }

        .box.unrevealed {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: black;
        }

        .box.revealed {
            background: linear-gradient(135deg, #4ade80, #16a34a);
            color: white;
        }

        .box-number {
            font-size: 2rem;
            font-weight: bold;
        }

        /* Ruleta Styles */
        .ruleta-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .ruleta-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffd700;
        }

        .ruleta-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 20px;
        }

        .ruleta {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #ffd700;
            position: relative;
            transition: transform 3s ease-out;
            background: conic-gradient(
                from 0deg,
                #ff6b6b 0deg 13.8deg,
                #4ecdc4 13.8deg 27.6deg,
                #45b7d1 27.6deg 41.4deg,
                #f9ca24 41.4deg 55.2deg,
                #f0932b 55.2deg 69deg,
                #eb4d4b 69deg 82.8deg,
                #6c5ce7 82.8deg 96.6deg,
                #ff6b6b 96.6deg 110.4deg,
                #4ecdc4 110.4deg 124.2deg,
                #45b7d1 124.2deg 138deg,
                #f9ca24 138deg 151.8deg,
                #f0932b 151.8deg 165.6deg,
                #eb4d4b 165.6deg 179.4deg,
                #6c5ce7 179.4deg 193.2deg,
                #ff6b6b 193.2deg 207deg,
                #4ecdc4 207deg 220.8deg,
                #45b7d1 220.8deg 234.6deg,
                #f9ca24 234.6deg 248.4deg,
                #f0932b 248.4deg 262.2deg,
                #eb4d4b 262.2deg 276deg,
                #6c5ce7 276deg 289.8deg,
                #ff6b6b 289.8deg 303.6deg,
                #4ecdc4 303.6deg 317.4deg,
                #45b7d1 317.4deg 331.2deg,
                #f9ca24 331.2deg 345deg,
                #f0932b 345deg 358.8deg,
                #eb4d4b 358.8deg 360deg
            );
        }

        .ruleta-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #ff0000;
            z-index: 10;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .ruleta-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            border: 3px solid white;
            z-index: 5;
            font-size: 12px;
        }

        .spin-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: #ffd700;
            color: black;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .spin-btn:hover {
            background: #ffed4e;
            transform: translateY(-2px);
        }

        .spin-btn:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
        }

        .participants-list {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 8px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 3px;
            overflow: hidden !important;
            max-height: none !important;
        }

        .participant-item {
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 8px;
            text-align: center;
            line-height: 1.1;
            flex: 0 0 auto;
            min-width: 45px;
            max-width: 80px;
            word-wrap: break-word;
        }

        .participant-item.used {
            background: rgba(100,100,100,0.5);
            color: #666;
            text-decoration: line-through;
        }

        .selected-winner {
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255,215,0,0.2);
            border-radius: 10px;
            border: 2px solid #ffd700;
        }

        .winner-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
        }

        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
        }

        .prize-display {
            text-align: center;
            max-width: 90%;
            max-height: 90%;
        }

        .prize-winner {
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .prize-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .prize-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .prize-title {
            font-size: 2rem;
            color: #333;
            font-weight: bold;
        }

        .default-prize {
            color: #333;
            font-size: 6rem;
            margin-bottom: 20px;
        }

        .back-instruction {
            font-size: 1.5rem;
            color: #ffd700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .stats {
            text-align: center;
            margin-top: 20px;
        }

        /* CONFETTI */
        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 999;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti-fall 4s linear infinite;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) rotate(360deg) scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: translateY(120vh) rotate(720deg) scale(0.8);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Panel principal -->
        <div class="main-panel">
            <div class="header">
                <h1 class="title">PANEL DE PREMIOS</h1>
                <h2 class="subtitle">HERENCIA TORRENTE</h2>
                <button class="music-btn" onclick="toggleMusic()">
                    🔊 Reproducir Música
                </button>
            </div>

            <div class="grid-container">
                <div class="grid-main" id="grid-main">
                    <!-- Primeras 24 casillas -->
                </div>
                <div class="grid-bottom" id="grid-bottom">
                    <!-- Casillas 25 y 26 centradas -->
                </div>
            </div>

            <div class="stats">
                <p>Casillas reveladas: <span id="revealed-count">0</span> / 26</p>
                <p>Haz clic en una casilla para revelar el premio</p>
            </div>
        </div>

        <!-- Panel de la ruleta -->
        <div class="ruleta-panel">
            <h3 class="ruleta-title">🎯 RULETA DE PARTICIPANTES</h3>
            
            <div id="selected-winner" class="selected-winner" style="display: none;">
                <div>Turno para:</div>
                <div class="winner-name" id="winner-name"></div>
            </div>

            <div class="ruleta-container">
                <div class="ruleta-pointer"></div>
                <div class="ruleta" id="ruleta">
                    <div class="ruleta-center">GIRA</div>
                </div>
            </div>

            <button class="spin-btn" id="spin-btn" onclick="spinRuleta()">
                🎲 GIRAR RULETA
            </button>

            <div class="participants-list" id="participants-list">
                <!-- Los participantes se generan dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Audio element for music -->
    <audio id="background-music" loop preload="auto">
        <source src="musica.mp3" type="audio/mpeg">
        <source src="MUSICA.mp3" type="audio/mpeg">
        <source src="cancion.mp3" type="audio/mpeg">
        <source src="audio.mp3" type="audio/mpeg">
    </audio>

    <script>
        // PARTICIPANTES ACTUALIZADOS
        const PARTICIPANTES = [
            "MIRELLA CABALLERO", "LOLI JUAREZ", "MARIA DOLORES", "GERMAN ROCA",
            "AMALIA SANCHEZ", "JAVIER CAMPILLO", "ALFONSO RAMIREZ", "JUAN MUÑOZ",
            "MARI CARMEN", "CRISTOBAL ORTUÑO", "ENRIQUE RUIZ", "RAQUEL HURTADO",
            "JUAN CARLOS", "MANUEL GALLEGO", "PACO CANO", "MERCEDES VIDAL",
            "JUANJO LOZANO", "MERCEDES FRUCTUOSO", "PEDRO J. SANCHEZ", "JOSE A. CARRION",
            "INMACULADA COSTA", "AMBROSIO", "AURELIO", "IVAN CUBEROS", "JAVIER AYLLON", "SAMUEL GARCIA"
        ];

        // Premios para cada casilla
        const PREMIOS = {};
        for (let i = 0; i < 26; i++) {
            PREMIOS[i] = {
                nombre: "Tu Premio Aquí",
                imagen: `imagenes/premio${i + 1}.jpg`
            };
        }

        // VARIABLES GLOBALES
        let revealedBoxes = new Set();
        let musicPlaying = false;
        let usedParticipants = new Set();
        let currentWinner = null;
        let isSpinning = false;

        // FUNCIÓN DE LA RULETA - CORREGIDA
        function spinRuleta() {
            if (isSpinning || usedParticipants.size >= PARTICIPANTES.length) return;

            isSpinning = true;
            const spinBtn = document.getElementById('spin-btn');
            spinBtn.disabled = true;
            spinBtn.textContent = 'GIRANDO...';

            // Sorteo completamente aleatorio
            const available = PARTICIPANTES.filter((_, index) => !usedParticipants.has(index));
            if (available.length === 0) {
                resetSpinButton();
                alert('¡Todos ya han participado!');
                return;
            }

            const randomIndex = Math.floor(Math.random() * available.length);
            const selectedParticipant = available[randomIndex];

            // ANIMACIÓN DE LA RULETA - CORREGIDA
            const ruleta = document.getElementById('ruleta');
            const participantIndex = PARTICIPANTES.indexOf(selectedParticipant);
            const degreesPerParticipant = 360 / PARTICIPANTES.length;
            const targetDegree = participantIndex * degreesPerParticipant;
            const spins = 8 + Math.random() * 5; // Más vueltas
            const totalDegrees = (spins * 360) + targetDegree;
            
            ruleta.style.transform = `rotate(${totalDegrees}deg)`;

            setTimeout(() => {
                // Marcar como usado
                const participantIndex = PARTICIPANTES.indexOf(selectedParticipant);
                usedParticipants.add(participantIndex);
                currentWinner = selectedParticipant;

                // Actualizar UI
                updateParticipantsList();
                showSelectedWinner(selectedParticipant);
                resetSpinButton();

                if (usedParticipants.size >= PARTICIPANTES.length) {
                    spinBtn.textContent = 'COMPLETADO';
                    spinBtn.disabled = true;
                }
            }, 3000);
        }

        function resetSpinButton() {
            const btn = document.getElementById('spin-btn');
            isSpinning = false;
            btn.disabled = false;
            btn.textContent = '🎲 GIRAR RULETA';
        }

        function initializeGrid() {
            const gridMain = document.getElementById('grid-main');
            const gridBottom = document.getElementById('grid-bottom');
            
            gridMain.innerHTML = '';
            gridBottom.innerHTML = '';
            
            // Crear las primeras 24 casillas
            for (let i = 1; i <= 24; i++) {
                const box = document.createElement('div');
                box.className = 'box unrevealed';
                box.innerHTML = `
                    <div class="box-number">${i}</div>
                    <div style="font-size: 16px; margin-top: 5px;">🎁</div>
                `;
                box.onclick = () => handleBoxClick(i - 1, i);
                gridMain.appendChild(box);
            }
            
            // Crear las casillas 25 y 26 centradas
            for (let i = 25; i <= 26; i++) {
                const box = document.createElement('div');
                box.className = 'box unrevealed';
                box.innerHTML = `
                    <div class="box-number">${i}</div>
                    <div style="font-size: 16px; margin-top: 5px;">🎁</div>
                `;
                box.onclick = () => handleBoxClick(i - 1, i);
                gridBottom.appendChild(box);
            }
        }

        function initializeParticipants() {
            const list = document.getElementById('participants-list');
            list.innerHTML = '';
            
            PARTICIPANTES.forEach((nombre, index) => {
                const item = document.createElement('div');
                item.className = 'participant-item';
                item.textContent = nombre;
                item.id = `participant-${index}`;
                list.appendChild(item);
            });
        }

        function updateParticipantsList() {
            PARTICIPANTES.forEach((nombre, index) => {
                const item = document.getElementById(`participant-${index}`);
                if (item) {
                    if (usedParticipants.has(index)) {
                        item.className = 'participant-item used';
                    } else {
                        item.className = 'participant-item';
                    }
                }
            });
        }

        function showSelectedWinner(winner) {
            const winnerDiv = document.getElementById('selected-winner');
            const winnerName = document.getElementById('winner-name');
            winnerName.textContent = winner;
            winnerDiv.style.display = 'block';
        }

        function handleBoxClick(index, boxNumber) {
            if (revealedBoxes.has(index)) return;
            
            if (!currentWinner) {
                alert('Primero gira la ruleta para elegir quién selecciona la casilla');
                return;
            }
            
            revealedBoxes.add(index);
            updateBoxWithWinner(index, boxNumber, currentWinner);
            showPrize(index, boxNumber, currentWinner);
            showConfetti();
            updateStats();
            
            // Limpiar ganador después de 2 segundos
            setTimeout(() => {
                currentWinner = null;
                document.getElementById('selected-winner').style.display = 'none';
            }, 2000);
        }

        // NUEVA FUNCIÓN - Actualizar casilla con nombre y foto
        function updateBoxWithWinner(index, boxNumber, winnerName) {
            const allBoxes = [...document.querySelectorAll('#grid-main .box'), ...document.querySelectorAll('#grid-bottom .box')];
            const box = allBoxes[index];
            
            if (box) {
                box.className = 'box revealed';
                const premio = PREMIOS[index];
                
                box.innerHTML = `
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 3px;">${boxNumber}</div>
                    <div style="font-size: 8px; margin-bottom: 5px; line-height: 1; color: white;">${winnerName}</div>
                    <img src="${premio.imagen}" alt="${premio.nombre}" 
                         style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px; margin-bottom: 3px;" 
                         onerror="this.outerHTML='<div style=\\"font-size: 25px; margin-bottom: 3px;\\">🎁</div>';">
                    <div style="font-size: 7px; line-height: 1; color: white;">${premio.nombre.length > 15 ? premio.nombre.substring(0, 12) + '...' : premio.nombre}</div>
                `;
            }
        }

        function showPrize(index, boxNumber, chooser) {
            const fullscreen = document.createElement('div');
            fullscreen.className = 'fullscreen';
            
            const premio = PREMIOS[index];
            
            fullscreen.innerHTML = `
                <div class="prize-display">
                    <div class="prize-winner">¡TE HA TOCADO DE PREMIO!</div>
                    <div style="font-size: 2.5rem; color: #ffed4e; margin-bottom: 15px; font-weight: bold;">
                        ${chooser}
                    </div>
                    <div style="font-size: 1.8rem; color: #ffd700; margin-bottom: 30px;">
                        Casilla ${boxNumber}
                    </div>
                    <div class="prize-container">
                        <img src="${premio.imagen}" alt="${premio.nombre}" class="prize-image" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div class="default-prize" style="display: none;">🎁</div>
                        <div class="prize-title">${premio.nombre}</div>
                    </div>
                    <div class="back-instruction">Toca la pantalla para volver al panel</div>
                </div>
            `;
            
            fullscreen.onclick = () => document.body.removeChild(fullscreen);
            document.body.appendChild(fullscreen);
        }

        // CONFETTI MEJORADO
        function showConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43', '#c44569', '#f8b500', '#a55eea', '#ff3838'];
            
            for (let i = 0; i < 150; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = Math.random() * 2 + 's';
                piece.style.animationDuration = (3 + Math.random() * 3) + 's';
                
                const size = 6 + Math.random() * 12;
                piece.style.width = size + 'px';
                piece.style.height = size + 'px';
                
                if (Math.random() > 0.5) {
                    piece.style.borderRadius = '50%';
                }
                
                confetti.appendChild(piece);
            }
            
            document.body.appendChild(confetti);
            
            setTimeout(() => {
                if (document.body.contains(confetti)) {
                    document.body.removeChild(confetti);
                }
            }, 6000);
        }

        // MÚSICA CORREGIDA
        function toggleMusic() {
            const music = document.getElementById('background-music');
            const btn = document.querySelector('.music-btn');
            
            if (musicPlaying) {
                music.pause();
                btn.innerHTML = '🔊 Reproducir Música';
                musicPlaying = false;
            } else {
                music.volume = 0.5;
                music.play().then(() => {
                    btn.innerHTML = '🔇 Pausar Música';
                    musicPlaying = true;
                }).catch(error => {
                    console.log('Error con la música:', error);
                    btn.innerHTML = '❌ Sin música';
                });
            }
        }

        function updateStats() {
            document.getElementById('revealed-count').textContent = revealedBoxes.size;
        }

        // INICIALIZACIÓN
        document.addEventListener('DOMContentLoaded', function() {
            initializeGrid();
            initializeParticipants();
            
            // Auto-música después del primer clic
            document.addEventListener('click', function() {
                if (!musicPlaying) {
                    const music = document.getElementById('background-music');
                    music.volume = 0.3;
                    music.play().then(() => {
                        musicPlaying = true;
                        const btn = document.querySelector('.music-btn');
                        btn.innerHTML = '🔇 Pausar Música';
                    }).catch(e => {
                        console.log('Música no disponible');
                    });
                }
            }, { once: true });
        });
    </script>
</body>
</html>